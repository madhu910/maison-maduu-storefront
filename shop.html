<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Collection // Maison Maduu & Co.</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            /* Default Theme (Men's) */
            --bg-color: #000000;
            --text-primary: #FFFFFF;
            --text-secondary: #a1a1a6;
            --card-bg: #1c1c1e;
            --border-color: #3a3a3c;
            --accent-color: #FFFFFF;
        }
        body.theme-women {
            /* Women's Theme */
            --bg-color: #F5F5F4;
            --text-primary: #1C1C1E;
            --text-secondary: #8A8A8E;
            --card-bg: #FFFFFF;
            --border-color: #EAEAEA;
            --accent-color: #B2844E;
        }
        *, *::before, *::after { box-sizing: border-box; }
        body { font-family: 'Inter', sans-serif; background-color: var(--bg-color); color: var(--text-primary); margin: 0; transition: background-color 0.5s ease, color 0.5s ease; }
        .container { max-width: 1440px; margin: 0 auto; padding: 0 2rem; }
        .main-header { padding: 1.5rem 0; border-bottom: 1px solid var(--border-color); text-align: center; background: var(--bg-color); }
        .nav-brand { font-size: 1.5rem; font-weight: 600; text-decoration: none; color: var(--text-primary); }
        .shop-header { padding: 4rem 0 2rem 0; text-align: center; }
        .shop-header h1 { font-size: 3.5rem; font-weight: 700; margin: 0; }
        .category-section { margin-bottom: 5rem; }
        .category-title { font-size: 2.5rem; font-weight: 700; margin-bottom: 2rem; padding-bottom: 1rem; border-bottom: 1px solid var(--border-color); }
        .product-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 3rem; }
        .card { text-decoration: none; color: var(--text-primary); text-align: center; transition: transform 0.3s ease; }
        .card:hover { transform: translateY(-8px); }
        .card .image-wrapper { background-color: var(--card-bg); border: 1px solid var(--border-color); border-radius: 18px; overflow: hidden; margin-bottom: 1.5rem; }
        .card img { width: 100%; height: 100%; aspect-ratio: 1/1; object-fit: cover; }
        .card h3 { font-size: 1.2rem; font-weight: 600; margin: 0.5rem 0; }
        .card p { font-size: 1.1rem; color: var(--text-secondary); margin: 0; }
    </style>
</head>
<body>
    <header class="main-header">
        <a href="index.html" class="nav-brand">Maison Maduu & Co.</a>
    </header>
    <div class="container">
        <main id="shop-main">
             <div class="shop-header">
                <h1 id="shop-title">Loading Collection...</h1>
            </div>
            </main>
    </div>
    <script>
        const API_BASE_URL = 'https://maison-maduu-backend.onrender.com';

        // --- THE "BRAIN" OF THE SMART CATEGORIZATION ---
        const CATEGORY_MAP = {
            'T-shirt': 'T-Shirts',
            'Sweatshirt': 'Sweatshirts',
            'Hoodie': 'Hoodies & Sweatshirts',
            'Beanie': 'Hats & Beanies',
            'Hat': 'Hats & Beanies',
            'Mug': 'Drinkware',
            'Bottle': 'Drinkware',
            'Poster': 'Home & Wall Art',
            'Phone Case': 'Accessories',
        };

        function getCategoryForProduct(title) {
            for (const keyword in CATEGORY_MAP) {
                if (title.toLowerCase().includes(keyword.toLowerCase())) {
                    return CATEGORY_MAP[keyword];
                }
            }
            return 'Miscellaneous'; // Fallback category
        }

        document.addEventListener('DOMContentLoaded', async () => {
            const gender = localStorage.getItem('shopGender') || 'men';
            document.body.className = `theme-${gender}`;
            document.getElementById('shop-title').textContent = `${gender === 'men' ? 'Men' : 'Women'}'s Collection`;

            const mainContainer = document.getElementById('shop-main');
            
            try {
                const response = await fetch(`${API_BASE_URL}/api/products`);
                const allProducts = await response.json();

                // Filter products based on gender selection
                const genderFilteredProducts = allProducts.filter(p => {
                    const titleLower = p.name.toLowerCase();
                    if (gender === 'men') {
                        // Show "Men's" and "Unisex" products
                        return titleLower.includes("men") || titleLower.includes("unisex");
                    } else {
                        // Show "Women's" and "Unisex" products
                        return titleLower.includes("women") || titleLower.includes("unisex");
                    }
                });

                // Group the filtered products by smart category
                const productsByCategory = {};
                genderFilteredProducts.forEach(product => {
                    const category = getCategoryForProduct(product.name);
                    if (!productsByCategory[category]) {
                        productsByCategory[category] = [];
                    }
                    productsByCategory[category].push(product);
                });

                // Dynamically build the page
                for (const category in productsByCategory) {
                    const section = document.createElement('section');
                    section.className = 'category-section';

                    let productsHTML = '';
                    productsByCategory[category].forEach(product => {
                        productsHTML += `
                            <a href="product.html?id=${product.id}" class="card">
                                <div class="image-wrapper">
                                    <img src="${product.thumbnail_url}" alt="${product.name}">
                                </div>
                                <h3>${product.name}</h3>
                                <p>${product.variants} Variants</p>
                            </a>`;
                    });

                    section.innerHTML = `
                        <h2 class="category-title">${category}</h2>
                        <div class="product-grid">${productsHTML}</div>
                    `;
                    mainContainer.appendChild(section);
                }

            } catch (e) {
                mainContainer.innerHTML += `<p>Failed to load products.</p>`;
            }
        });
    </script>
</body>
</html>
