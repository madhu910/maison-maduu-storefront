<!DOCTYPE html>
<html lang="en">
<head>
    <style>
        /* CSS is the same as your last working shop.html */
    </style>
</head>
<body>
    <script>
        const API_BASE_URL = 'https://maison-maduu-backend.onrender.com';
        let allProducts = [];

        document.addEventListener('DOMContentLoaded', async () => {
            const productGrid = document.getElementById("product-grid");
            productGrid.innerHTML = `<p class="message">>> Accessing data stream...</p>`;
            try {
                const response = await fetch(`${API_BASE_URL}/api/products`);
                allProducts = await response.json();
                
                populateFilters();

                // --- NEW LOGIC IS HERE ---
                // Check if a category was passed in the URL
                const params = new URLSearchParams(window.location.search);
                const categoryFromURL = params.get('category');
                
                if (categoryFromURL) {
                    const categoryFilter = document.getElementById('category-filter');
                    // Check if the category exists in the dropdown
                    if ([...categoryFilter.options].some(o => o.value === categoryFromURL)) {
                        categoryFilter.value = categoryFromURL;
                    }
                }
                
                applyFiltersAndSort(); // This will now use the pre-selected category

            } catch (e) { /* ... error handling ... */ }
            
            document.getElementById('category-filter').addEventListener('change', applyFiltersAndSort);
            document.getElementById('sort-filter').addEventListener('change', applyFiltersAndSort);
        });

        function populateFilters() {
            const categoryFilter = document.getElementById('category-filter');
            // Using Printful's main_category_name for better filtering
            const categories = [...new Set(allProducts.map(p => p.main_category_name).filter(Boolean))];
            categories.forEach(cat => {
                const option = document.createElement('option');
                option.value = cat;
                option.textContent = cat;
                categoryFilter.appendChild(option);
            });
        }

        function applyFiltersAndSort() {
            const category = document.getElementById('category-filter').value;
            const sort = document.getElementById('sort-filter').value;
            let processedProducts = [...allProducts];

            if (category !== 'all') {
                processedProducts = processedProducts.filter(p => p.main_category_name === category);
            }

            // ... The rest of the sorting and rendering logic is the same ...
        }

        function renderGrid(products) {
            // ... This function is the same ...
        }
    </script>
</body>
</html>
